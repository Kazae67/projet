{% extends 'base.html.twig' %}

{% block title %}
    Product details - {{ product.name }}
{% endblock %}

{% block body %}
    <div class="parent-container">
        <div class="demi-cercle"></div>
        <div class="form-container">
            <h1>{{ product.name }}</h1>

            <div class="product-detail">
                <img src="{{ product.image_url|default('/images/default-image.jpg') }}" alt="{{ product.name }}" class="product-img">
                <p><strong>Description:</strong> {{ product.description }}</p>
                <p><strong>Price:</strong> {{ product.price }}€</p>
                <p><strong>Quantity in stock:</strong> {{ product.stockQuantity }}</p>
                <p><strong>Date of creation:</strong> {{ product.createdAt ? product.createdAt|date('d-m-Y H:i') : 'Not specified.' }}</p>
                <p><strong>Update date:</strong> {{ product.updatedAt ? product.updatedAt|date('d-m-Y H:i') : 'Not specified.' }}</p>

                <!-- Bouton pour ajouter une revue -->
                <button id="add-review-button" class="btn btn-primary">Add a review</button>

                <!-- Container pour le formulaire de revue -->
                <div id="review-form-container" style="display:none;">
                    {% include 'review/add.html.twig' with {'form': form} %}
                </div>

                <!-- Affichage des revues existantes -->
                <div class="product-reviews">
                    <h3>Review</h3>
                    {% for review in product.reviews %}
                        <div class="review" id="review-{{ review.id }}">
                            <p id="review-title-{{ review.id }}"><strong>Title:</strong> {{ review.title }}</p> <!-- Ajout de l'ID pour le titre -->
                            <p id="review-rating-{{ review.id }}"><strong>Rating:</strong> {{ review.rating }}/5</p> <!-- Ajout de l'ID pour la note -->
                            <div id="review-comment-{{ review.id }}">{{ review.comment }}</div>
                            {% if app.user and app.user == review.user %}
                                <button class="btn btn-edit" onclick="editReview({{ review.id }})">Edit</button>
                                <a href="{{ path('review_delete', {'id': review.id}) }}" class="btn btn-delete" onclick="return confirm('Are you sure you want to delete this review ?');">Delete</a>

                                <!-- Formulaire d'édition, caché par défaut -->
                                <div id="edit-review-form-{{ review.id }}" style="display:none;">
                                    <input type="text" id="edit-title-{{ review.id }}" class="form-control" value="{{ review.title }}">
                                    <input type="number" id="edit-rating-{{ review.id }}" class="form-control" value="{{ review.rating }}" min="1" max="5">
                                    <textarea id="edit-comment-{{ review.id }}" class="form-control">{{ review.comment }}</textarea>
                                    <button onclick="submitReviewEditForm(event, {{ review.id }})" class="btn btn-update">Update</button>
                                </div>
                            {% endif %}
                        </div>
                    {% else %}
                        <p>No review for this product.</p>
                    {% endfor %}
                </div>
            </div>
            <a href="{{ path('product') }}" class="btn btn-back">Back to products list</a>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('js/edit-review.js') }}"></script>
{% endblock %}
